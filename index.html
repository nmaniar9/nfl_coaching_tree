<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Coaching Tree Visualization</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #1e3a8a;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: monospace;
        }
        
        button {
            padding: 8px 16px;
            margin-right: 10px;
            margin-bottom: 20px;
            background-color: #1e3a8a;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #2563eb;
        }
        
        button#load-sample {
            background-color: #059669;
        }
        
        button#reset-view {
            background-color: #dc2626;
        }
        
        #coaching-tree {
            position: relative;
            min-height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: auto;
            background-color: white;
        }
        
        .coach-node {
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-weight: bold;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 10px;
            word-break: break-word;
        }
        
        .coach-node:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
        }
        
        .coach-node.head-coach {
            background-color: #1e3a8a;
        }
        
        .coach-node.coordinator {
            background-color: #059669;
        }
        
        .coach-node.highlighted {
            border: 5px solid #f59e0b;
        }
        
        .connection {
            position: absolute;
            height: 3px;
            background-color: #94a3b8;
            transform-origin: left center;
            opacity: 0.7;
        }
        
        .connection.highlighted {
            background-color: #f59e0b;
            height: 5px;
            opacity: 1;
        }
        
        .info-card {
            position: absolute;
            background-color: white;
            width: 320px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            z-index: 10;
            display: none;
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #9ca3af;
        }
        
        .career-item {
            margin-bottom: 10px;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .career-item.head-coach {
            background-color: rgba(30, 58, 138, 0.1);
            border-left: 4px solid #1e3a8a;
        }
        
        .career-item.coordinator {
            background-color: rgba(5, 150, 105, 0.1);
            border-left: 4px solid #059669;
        }
        
        footer {
            margin-top: 20px;
            text-align: center;
            font-size: 0.9rem;
            color: #6b7280;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>NFL Coaching Tree Visualization</h1>
        
        <textarea id="data-input" placeholder="Paste CSV data here including headers: Season,head_coach,coordinator,role,team,wins,losses,ties"></textarea>
        
        <div>
            <button id="load-data">Load Data</button>
            <button id="load-sample">Load Sample Data</button>
            <button id="reset-view">Reset View</button>
        </div>
        
        <div id="coaching-tree"></div>
        
        <footer>
            <p>NFL Coaching Tree Visualization Tool</p>
            <div>
                <a href="https://your-portfolio-url.com" id="portfolio-link">Aayush Munshi</a> | 
                <a href="https://github.com/Yush10/NFL_Coaching_Tree" id="github-link">GitHub</a>
            </div>
        </footer>
    </div>
    
    <!-- Your existing JavaScript code will be linked here -->
    <script>
    /**
     * NFL Coaching Tree Visualization
     * 
     * An interactive visualization tool for exploring relationships 
     * between NFL head coaches and their coordinators.
     */

    // Sample data for demonstration
    const sampleData = `Season,head_coach,coordinator,role,team,wins,losses,ties
2021,Andy Reid,Eric Bieniemy,Offensive Coordinator,Kansas City Chiefs,12,5,0
2021,Andy Reid,Steve Spagnuolo,Defensive Coordinator,Kansas City Chiefs,12,5,0
2020,Andy Reid,Eric Bieniemy,Offensive Coordinator,Kansas City Chiefs,14,2,0
2020,Andy Reid,Steve Spagnuolo,Defensive Coordinator,Kansas City Chiefs,14,2,0
2021,Sean McVay,Kevin O'Connell,Offensive Coordinator,Los Angeles Rams,12,5,0
2021,Sean McVay,Raheem Morris,Defensive Coordinator,Los Angeles Rams,12,5,0
2020,Sean McVay,Kevin O'Connell,Offensive Coordinator,Los Angeles Rams,10,6,0
2020,Sean McVay,Brandon Staley,Defensive Coordinator,Los Angeles Rams,10,6,0
2022,Kevin O'Connell,Wes Phillips,Offensive Coordinator,Minnesota Vikings,13,4,0
2022,Kevin O'Connell,Ed Donatell,Defensive Coordinator,Minnesota Vikings,13,4,0
2022,Brandon Staley,Joe Lombardi,Offensive Coordinator,Los Angeles Chargers,10,7,0
2022,Brandon Staley,Renaldo Hill,Defensive Coordinator,Los Angeles Chargers,10,7,0
2019,Matt LaFleur,Nathaniel Hackett,Offensive Coordinator,Green Bay Packers,13,3,0
2019,Matt LaFleur,Mike Pettine,Defensive Coordinator,Green Bay Packers,13,3,0
2022,Nathaniel Hackett,Justin Outten,Offensive Coordinator,Denver Broncos,4,11,0
2022,Nathaniel Hackett,Ejiro Evero,Defensive Coordinator,Denver Broncos,4,11,0
2018,Sean McVay,Matt LaFleur,Offensive Coordinator,Los Angeles Rams,13,3,0
2018,Sean McVay,Wade Phillips,Defensive Coordinator,Los Angeles Rams,13,3,0`;

    class CoachingTreeVisualization {
        /**
         * Initialize the coaching tree visualization
         */
        constructor() {
            // Core data structures
            this.coachingData = [];
            this.coaches = {};
            this.connections = [];
            this.activeInfoCard = null;
            
            // DOM elements
            this.treeElement = document.getElementById('coaching-tree');
            
            // Bind event handlers
            document.getElementById('load-data').addEventListener('click', () => this.loadData());
            document.getElementById('reset-view').addEventListener('click', () => this.resetView());
            document.getElementById('load-sample').addEventListener('click', () => this.loadSampleData());
            
            // Add keydown listener for Escape key to close info card
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') this.hideInfoCard();
            });
            
            // Set default tree dimensions
            this.treeWidth = 1200;
            this.treeHeight = 600;
            this.nodeRadius = 60;
            
            // Set up portfolio links
            this.setupPortfolioLinks();
        }
        
        loadStaticData() {
            // Parse the static CSV data
            this.coachingData = this.parseCSV(staticCsvData);
            if (this.coachingData.length === 0) {
                this.showAlert('No valid data found in static CSV');
                return;
            }
            
            // Process coaching data
            this.processCoachingData();
            
            // Calculate positions
            this.calculatePositions();
            
            // Render the visualization
            this.renderVisualization();
            
            // Also update the textarea to show the data
            document.getElementById('data-input').value = staticCsvData;
        }
        
        /**
         * Set up portfolio and GitHub links
         */
        setupPortfolioLinks() {
            const portfolioLink = document.getElementById('portfolio-link');
            const githubLink = document.getElementById('github-link');
            
            if (portfolioLink) {
                portfolioLink.href = "https://your-portfolio-url.com";
                portfolioLink.textContent = "Aayush Munshi";
            }
            
            if (githubLink) {
                githubLink.href = "https://github.com/Yush10/NFL_Coaching_Tree";
            }
        }
        
        /**
         * Load sample data into the visualization
         */
        loadSampleData() {
            document.getElementById('data-input').value = sampleData;
            this.loadData();
        }
        
        /**
         * Load and process data from input field
         */
        loadData() {
            const csvData = document.getElementById('data-input').value;
            if (!csvData) {
                this.showAlert('Please paste CSV data first');
                return;
            }
            
            // Parse CSV data
            this.coachingData = this.parseCSV(csvData);
            if (this.coachingData.length === 0) {
                this.showAlert('No valid data found');
                return;
            }
            
            // Process coaching data
            this.processCoachingData();
            
            // Calculate positions
            this.calculatePositions();
            
            // Render the visualization
            this.renderVisualization();
        }
        
        /**
         * Show alert message to the user
         * @param {string} message - The message to display
         */
        showAlert(message) {
            alert(message);
        }
        
        /**
         * Parse CSV text into structured data
         * @param {string} csvText - Raw CSV text
         * @returns {Array} - Array of objects representing data rows
         */
        parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',');
            
            // Check if we have the required headers
            const requiredHeaders = ['Season', 'head_coach', 'coordinator', 'role', 'team', 'wins', 'losses', 'ties'];
            const missingHeaders = requiredHeaders.filter(h => !headers.includes(h));
            
            if (missingHeaders.length > 0) {
                this.showAlert(`Missing required headers: ${missingHeaders.join(', ')}`);
                return [];
            }
            
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length === headers.length) {
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index];
                    });
                    data.push(row);
                }
            }
            
            return data;
        }
        
        /**
         * Process coaching data to build relationships
         */
        processCoachingData() {
            this.coaches = {};
            this.connections = [];
            
            // First pass: Collect all coaches and their roles
            this.coachingData.forEach(row => {
                const season = parseInt(row.Season);
                
                // Add head coach
                if (!this.coaches[row.head_coach]) {
                    this.coaches[row.head_coach] = {
                        name: row.head_coach,
                        roles: [],
                        coordinatorsUnder: new Set(),
                        headCoachesOver: new Set(),
                        level: 0  // Level will be calculated later
                    };
                }
                
                // Add head coach role if not already present for this season/team
                const existingHeadCoachRole = this.coaches[row.head_coach].roles.find(r => 
                    r.season === season && r.team === row.team && r.role === 'Head Coach'
                );
                
                if (!existingHeadCoachRole) {
                    this.coaches[row.head_coach].roles.push({
                        season: season,
                        team: row.team,
                        role: 'Head Coach',
                        record: `${row.wins}-${row.losses}-${row.ties}`
                    });
                }
                
                // Add coordinator
                if (!this.coaches[row.coordinator]) {
                    this.coaches[row.coordinator] = {
                        name: row.coordinator,
                        roles: [],
                        coordinatorsUnder: new Set(),
                        headCoachesOver: new Set(),
                        level: 0
                    };
                }
                
                // Add coordinator role
                this.coaches[row.coordinator].roles.push({
                    season: season,
                    team: row.team,
                    role: row.role,
                    record: `${row.wins}-${row.losses}-${row.ties}`
                });
                
                // Create connections between head coach and coordinator
                this.coaches[row.head_coach].coordinatorsUnder.add(row.coordinator);
                this.coaches[row.coordinator].headCoachesOver.add(row.head_coach);
                
                // Store connection with specific team and season
                this.connections.push({
                    head: row.head_coach,
                    coordinator: row.coordinator,
                    season: season,
                    team: row.team
                });
            });
            
            // Calculate levels for positioning (how deep in the hierarchy)
            this.calculateLevels();
        }
        
        /**
         * Calculate hierarchical levels for coaches
         */
        calculateLevels() {
            // Find root coaches (those who were never coordinators or were head coaches first)
            const rootCoaches = Object.values(this.coaches).filter(coach => {
                // Coach was never a coordinator or was a head coach before being a coordinator
                const wasCoordinator = coach.roles.some(r => r.role !== 'Head Coach');
                const wasHeadCoach = coach.roles.some(r => r.role === 'Head Coach');
                
                if (!wasCoordinator) {
                    return wasHeadCoach; // Only root if they were actually a head coach
                }
                
                // Find earliest seasons as head coach and coordinator
                const earliestHeadCoachSeason = wasHeadCoach ? 
                    Math.min(...coach.roles
                        .filter(r => r.role === 'Head Coach')
                        .map(r => r.season)) : Infinity;
                
                const earliestCoordinatorSeason = wasCoordinator ?
                    Math.min(...coach.roles
                        .filter(r => r.role !== 'Head Coach')
                        .map(r => r.season)) : Infinity;
                
                // Root coach if they were head coach first
                return wasHeadCoach && earliestHeadCoachSeason <= earliestCoordinatorSeason;
            });
            
            // Assign level 0 to root coaches
            rootCoaches.forEach(coach => {
                coach.level = 0;
            });
            
            // Calculate levels for all other coaches through BFS
            const queue = [...rootCoaches];
            const visited = new Set(rootCoaches.map(c => c.name));
            
            while (queue.length > 0) {
                const currentCoach = queue.shift();
                
                // Process all coordinators under this coach
                currentCoach.coordinatorsUnder.forEach(coordinatorName => {
                    const coordinator = this.coaches[coordinatorName];
                    
                    // Set level to max of current level or head coach's level + 1
                    coordinator.level = Math.max(coordinator.level, currentCoach.level + 1);
                    
                    // Add to queue if not visited
                    if (!visited.has(coordinatorName)) {
                        visited.add(coordinatorName);
                        queue.push(coordinator);
                    }
                });
            }
            
            // Handle any remaining coaches (those without clear hierarchical connections)
            Object.values(this.coaches).forEach(coach => {
                if (!visited.has(coach.name)) {
                    const maxLevel = Object.values(this.coaches)
                        .filter(c => visited.has(c.name))
                        .reduce((max, c) => Math.max(max, c.level), 0);
                        
                    coach.level = maxLevel + 1;
                    visited.add(coach.name);
                }
            });
        }
        
        /**
         * Calculate positions for coach nodes in the visualization
         */
        calculatePositions() {
            // Group coaches by level
            const coachesByLevel = {};
            Object.values(this.coaches).forEach(coach => {
                if (!coachesByLevel[coach.level]) {
                    coachesByLevel[coach.level] = [];
                }
                coachesByLevel[coach.level].push(coach);
            });
            
            // Count maximum number of coaches at any level
            const maxCoachesAtAnyLevel = Math.max(
                ...Object.values(coachesByLevel).map(coaches => coaches.length)
            );
            
            // Calculate total levels
            const totalLevels = Math.max(
                ...Object.values(this.coaches).map(c => c.level)
            ) + 1;
            
            // Adjust tree height based on number of levels
            this.treeHeight = Math.max(600, totalLevels * 200);
            
            // Adjust tree width based on maximum coaches at any level
            this.treeWidth = Math.max(1000, maxCoachesAtAnyLevel * 180);
            
            // Assign positions to coaches based on level
            Object.keys(coachesByLevel).forEach(level => {
                const coaches = coachesByLevel[level];
                const levelY = parseInt(level) * (this.treeHeight / totalLevels) + 100;
                
                // Sort coaches alphabetically within level for better organization
                coaches.sort((a, b) => a.name.localeCompare(b.name));
                
                coaches.forEach((coach, index) => {
                    const spacing = this.treeWidth / (coaches.length + 1);
                    const x = (index + 1) * spacing;
                    
                    coach.x = x;
                    coach.y = levelY;
                });
            });
        }
        
        /**
         * Render the entire visualization
         */
        renderVisualization() {
            // Clear existing visualization
            this.treeElement.innerHTML = '';
            this.treeElement.style.width = `${this.treeWidth}px`;
            this.treeElement.style.height = `${this.treeHeight}px`;
            
            // Render connections first (so they appear behind nodes)
            this.renderConnections();
            
            // Render coach nodes
            this.renderCoachNodes();
        }
        
        /**
         * Render connection lines between coaches
         */
        renderConnections() {
            this.connections.forEach(connection => {
                const headCoach = this.coaches[connection.head];
                const coordinator = this.coaches[connection.coordinator];
                
                const connectionEl = document.createElement('div');
                connectionEl.className = 'connection';
                connectionEl.dataset.head = connection.head;
                connectionEl.dataset.coordinator = connection.coordinator;
                connectionEl.dataset.season = connection.season;
                connectionEl.dataset.team = connection.team;
                
                // Calculate position and rotation
                const dx = coordinator.x - headCoach.x;
                const dy = coordinator.y - headCoach.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const angle = Math.atan2(dy, dx) * 180 / Math.PI;
                
                // Position connection
                connectionEl.style.left = `${headCoach.x}px`;
                connectionEl.style.top = `${headCoach.y}px`;
                connectionEl.style.width = `${distance}px`;
                connectionEl.style.transform = `rotate(${angle}deg)`;
                
                this.treeElement.appendChild(connectionEl);
            });
        }
        
        /**
         * Render coach nodes (circles)
         */
        renderCoachNodes() {
            Object.values(this.coaches).forEach(coach => {
                const nodeEl = document.createElement('div');
                nodeEl.className = 'coach-node';
                
                // Check if this coach was ever a head coach
                const wasHeadCoach = coach.roles.some(r => r.role === 'Head Coach');
                if (wasHeadCoach) {
                    nodeEl.classList.add('head-coach');
                } else {
                    nodeEl.classList.add('coordinator');
                }
                
                nodeEl.textContent = coach.name;
                nodeEl.style.left = `${coach.x - this.nodeRadius}px`;
                nodeEl.style.top = `${coach.y - this.nodeRadius}px`;
                nodeEl.dataset.coach = coach.name;
                
                // Add click event
                nodeEl.addEventListener('click', (e) => {
                    this.showCoachInfo(coach, e.clientX, e.clientY);
                });
                
                this.treeElement.appendChild(nodeEl);
            });
        }
        
        /**
         * Show coach information in a popup card
         * @param {Object} coach - Coach data object
         * @param {number} clientX - Click X position
         * @param {number} clientY - Click Y position
         */
        showCoachInfo(coach, clientX, clientY) {
            // Remove any existing info card
            this.hideInfoCard();
            
            // Create new info card
            const infoCard = document.createElement('div');
            infoCard.className = 'info-card';
            
            // Add close button
            const closeBtn = document.createElement('span');
            closeBtn.className = 'close-btn';
            closeBtn.textContent = '×';
            closeBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                this.hideInfoCard();
            });
            infoCard.appendChild(closeBtn);
            
            // Add coach name
            const nameHeading = document.createElement('h3');
            nameHeading.textContent = coach.name;
            infoCard.appendChild(nameHeading);
            
            // Sort roles by season (newest first)
            const sortedRoles = [...coach.roles].sort((a, b) => b.season - a.season);
            
            // Add career history
            sortedRoles.forEach(role => {
                const careerItem = document.createElement('div');
                careerItem.className = `career-item ${role.role === 'Head Coach' ? 'head-coach' : 'coordinator'}`;
                
                const teamYear = document.createElement('div');
                teamYear.className = 'team-year';
                teamYear.textContent = `${role.team} (${role.season})`;
                careerItem.appendChild(teamYear);
                
                const roleEl = document.createElement('div');
                roleEl.className = 'role';
                roleEl.textContent = role.role;
                careerItem.appendChild(roleEl);
                
                const recordEl = document.createElement('div');
                recordEl.className = 'record';
                recordEl.textContent = `Record: ${role.record}`;
                careerItem.appendChild(recordEl);
                
                // Add click event to highlight connected coaches
                careerItem.addEventListener('click', () => {
                    this.highlightConnections(coach.name, role.team, role.season);
                });
                
                infoCard.appendChild(careerItem);
            });
            
            // Position the card
            const scrollX = window.scrollX;
            const scrollY = window.scrollY;
            const treeRect = this.treeElement.getBoundingClientRect();
            
            let left = clientX - treeRect.left + scrollX;
            let top = clientY - treeRect.top + scrollY;
            
            // Adjust position if it would go off screen
            if (left + 320 > treeRect.width) {
                left = left - 320;
            }
            
            infoCard.style.left = `${left}px`;
            infoCard.style.top = `${top}px`;
            
            // Add card to the tree
            this.treeElement.appendChild(infoCard);
            infoCard.style.display = 'block';
            
            this.activeInfoCard = infoCard;
        }
        
        /**
         * Hide the active info card
         */
        hideInfoCard() {
            if (this.activeInfoCard) {
                this.activeInfoCard.remove();
                this.activeInfoCard = null;
            }
        }
        
        /**
         * Highlight connections for a specific coach, team, and season
         * @param {string} coachName - Name of the coach
         * @param {string} team - Team name
         * @param {number} season - Season year
         */
        highlightConnections(coachName, team, season) {
            // Reset all highlights
            this.resetHighlights();
            
            // Find all connections for this coach, team, and season
            const relatedConnections = this.connections.filter(conn => 
                (conn.head === coachName || conn.coordinator === coachName) && 
                conn.team === team && 
                conn.season === parseInt(season)
            );
            
            // Highlight connections
            relatedConnections.forEach(conn => {
                const connectionEls = document.querySelectorAll(`.connection[data-head="${conn.head}"][data-coordinator="${conn.coordinator}"][data-season="${conn.season}"][data-team="${conn.team}"]`);
                connectionEls.forEach(el => {
                    el.classList.add('highlighted');
                });
                
                // Highlight related coach nodes
                const headCoachEl = document.querySelector(`.coach-node[data-coach="${conn.head}"]`);
                const coordinatorEl = document.querySelector(`.coach-node[data-coach="${conn.coordinator}"]`);
                
                if (headCoachEl) headCoachEl.classList.add('highlighted');
                if (coordinatorEl) coordinatorEl.classList.add('highlighted');
            });
        }
        
        /**
         * Reset all highlights
         */
        resetHighlights() {
            document.querySelectorAll('.connection.highlighted').forEach(el => {
                el.classList.remove('highlighted');
            });
            
            document.querySelectorAll('.coach-node.highlighted').forEach(el => {
                el.classList.remove('highlighted');
            });
        }
        
        /**
         * Reset the entire visualization view
         */
        resetView() {
            this.resetHighlights();
            this.hideInfoCard();
        }
    }

    // Initialize visualization when the page loads
    document.addEventListener('DOMContentLoaded', () => {
        const visualization = new CoachingTreeVisualization();
        // Load sample data by default for demonstration
        visualization.loadSampleData();
    });
    </script>
</body>
</html>
